//@version=5
indicator("Mega Coverage Fixture", overlay=true, max_bars_back=500)

// Inputs
len = input.int(14, "Length", minval=1)
src = input.source(close, "Source")
th = input.float(1.5, "Threshold", step=0.1)
useGrad = input.bool(true, "Use Gradient")

// User-defined function with => and switch
ma(src, len, type) =>
    switch type
        "SMA" => ta.sma(src, len)
        "EMA" => ta.ema(src, len)
        "WMA" => ta.wma(src, len)
        => ta.sma(src, len)

// Arrays
var float score = 0.0
arr = array.new_float(5)
array.set(arr, 0, 1.0)
array.set(arr, 1, 2.0)
array.set(arr, 2, 3.0)
array.set(arr, 3, 4.0)
array.set(arr, 4, 5.0)
mx = array.max(arr)
idx = array.indexof(arr, mx)

// Loops + series indexing + ternary
for i = 1 to len
    sigUp = ta.crossover(src[i], src[i+1])
    sigDn = ta.crossunder(src[i], src[i+1])
    profit = sigUp ? (src[i] - src[i+1]) : sigDn ? (src[i+1] - src[i]) : 0
    score := score + profit

// If / else if / else blocks
trend = src > ta.sma(src, len) ? "Bull" : src < ta.sma(src, len) ? "Bear" : "Flat"

// Colors / tables / plotting
baseColor = color.rgb(32, 64, 160)
col = useGrad ? color.new(baseColor, 10) : color.new(color.gray, 90)

p = plot(src, color=col, title="Src")
p2 = plot(ta.sma(src, len), color=color.new(color.blue, 10), title="MA")
fill(p, p2, color=color.new(color.green, 80))

buy = ta.crossover(src, ta.sma(src, len))
sell = ta.crossunder(src, ta.sma(src, len))

plotshape(buy ? src : na, title="Buy", style=shape.triangleup, location=location.belowbar, color=color.green, size=size.small)
plotshape(sell ? src : na, title="Sell", style=shape.triangledown, location=location.abovebar, color=color.red, size=size.small)

if bar_index % 50 == 0
    var t = table.new(position.top_right, 2, 2, border_width=1)
    table.cell(t, 0, 0, "Trend")
    table.cell(t, 1, 0, trend)
    table.cell(t, 0, 1, "Score")
    table.cell(t, 1, 1, str.tostring(score))
